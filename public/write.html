<!doctype html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width, height=device-height">
	<title>VOM(Voice Of Modernhouse)</title>
	<meta name="description" content="VOM">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
	<script type="text/javascript" src="common.js"></script>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/styles.css">
</head>
<body>
	<div style="margin-left: 20px">
		<div class="div_rw_top">
			<p style="font-size: 25px">새 글 작성</p>
			<p style="font-size: 12px; margin-top: -18px;">새로운 글을 작성해 주세요</p>
		</div>
			<select id="select_branch" onchange="chgBranch()">
				<option value="">지점을 선택해 주세요</option>
			</select><br>
			
			<select id="select_PU" onchange="chgPU()">
				<option value="">PU를 선택해 주세요</option>
			</select><br>
			
			<input type="text" id="title" placeholder="제목"><br/>
			<div style="width: 100%; float: left">
				<input type="checkbox" id="chkBox_pwd" onchange="setSecret()"><b style="font-size: 13px;">&nbsp;비밀글 설정</b> 
				<input type="password" id="text_pwd" placeholder="비밀번호" disabled="disabled"><br/><br/>
			</div>
			
			<hr style="width: 93%">
			<textarea rows="10" cols="20" id="content"></textarea><br/>
			<hr style="width: 93%">
			
			<input type="file" id="profilePhotoFileUpload"><br/>
			<div style="float: left; width: 100%; margin-bottom: 15px;">
				<input id="btn_submit" type="button" value="확인" onclick="FormCheck()" />
				<button id="btn_cancle" onclick="javascript:location='index.html'">취소</button>
			</div>
		</div>
	
<script type="text/javascript">
	Parse.initialize("VlzoLnwwdwKUwvKFUPEKSadvZlL6SeVmPuRDy8ac", "fxEr0NEeRaD6rfs80NEO21t6efQm3FwHwgwaQPuH");
	
	var select_branch = document.getElementById("select_branch");
	var select_pu = document.getElementById("select_PU");
	var branch;
	var pu;

	AddOption('Branch', 'select_branch');
	AddOption('PU', 'select_PU');
			
	function chgBranch(){
		branch = select_branch.options[select_branch.selectedIndex].innerHTML;
	}
	
	function chgPU(){
		pu = select_pu.options[select_pu.selectedIndex].innerHTML;
	}
	
	function setSecret(){
		var flag = $("#chkBox_pwd").attr("checked");
		if(flag == "checked"){
			document.getElementById("text_pwd").disabled = false;
		}else{
			document.getElementById("text_pwd").disabled = true;
		}
	}
		
	function FormCheck() {
		
		var title = document.getElementById("title").value;	 
		var content = document.getElementById("content").value;
		var parseFile = null;

		if (branch == null || branch == ""){	  // null인지 비교한 뒤
			alert('지점을 선택하세요');		   // 경고창을 띄우고
			document.getElementById("branch").focus();	// 해당태그에 포커스를 준뒤
			return false;					   // false를 리턴합니다.
		}

		if (pu == null || pu == ""){	  // null인지 비교한 뒤
			alert('PU를 선택하세요');		   // 경고창을 띄우고
			document.getElementById("pu").focus();	// 해당태그에 포커스를 준뒤
			return false;					   // false를 리턴합니다.
		}

		if (title == null ||  title  == ""){   
			alert('제목을 입력하세요'); 
			document.getElementById("title").focus();			
			return false;			   
		}
		 
		if (content == null ||  content == ""){
			alert('내용을 입력하세요'); 
			document.getElementById("content").focus();
			return false;
		}

		parseFile = UploadFile();

		CreateItem(branch, pu, title, content, true, parseFile);
	}

	function UploadFile() {
		var fileUploadControl = $("#profilePhotoFileUpload")[0];
		if (fileUploadControl.files.length > 0) {
			var file = fileUploadControl.files[0];
			var name = fileUploadControl.files[0].name;
			var parseFile = new Parse.File(name, file);

			parseFile.save().then(function() {
				// The file has been saved to Parse.
			}, function(error) {
				// The file either could not be read, or could not be saved to Parse.
				alert('UploadFile Failed: ' + error.description);
			});

			//parseFile.save();
			return parseFile;
		}
		else
			return null;
	}

	function CreateItem(strBranch, strPU, strTitle, strContent, bPublic, file) {
		var Item = Parse.Object.extend("BBS");
		var item = new Item();

		item.set("Branch", strBranch);
		item.set("PU", strPU);
		item.set("Title", strTitle);
		item.set("Content", strContent);
		item.set("Public", bPublic);
		item.set("File", file);

		item.save(null, {
			success: function(item) {
				location.href="index.html";
			},
			error: function(item, error) {
				alert('CreateItem Failed: ' + error.description);
			}
		});
	}
</script>
</body>

</html>